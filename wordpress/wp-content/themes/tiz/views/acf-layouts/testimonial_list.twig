{# Testimonial list section (with title card on the left)
Inputs via Flexible Content — layout name: testimonial_list
- section.heading: string (title)
- section.testimonials: Relationship of testimonial posts
- section.background_color: hex or tailwind class
- section.show_google_logo: boolean (true_false)
#}

{% set heading = section.heading %}
{% set selected = section.testimonials|default([]) %}
{% set bg = section.background_color|default('') %}
{% set is_class = bg starts with 'bg-' %}
{% set bg_style = (bg and not is_class) ? 'background-color: ' ~ bg : '' %}
{% set card_bg = section.card_background_color|default('') %}
{% set card_bg_style = card_bg ? 'background-color: ' ~ card_bg : '' %}

{# Normalize ACF true_false to boolean #}
{% set show_google_logo = section.show_google_logo in [true, 1, '1', 'true', 'on', 'yes'] %}

{# Map selected posts to items for the testimonial card component #}
{% set items = [] %}
{% for s in selected %}
	{% set testimonial_post = s.testimonial ?? null %}
	{% set pid = testimonial_post.ID ?? testimonial_post.id ?? 0 %}
	{% if pid %}
		{% set r = function('get_field', 'rating', pid) %}
		{% set testimonial = function('get_field', 'testimonial', pid) %}
		{% set full_name = function('get_field', 'full_name', pid) %}
		{% set company = function('get_field', 'company', pid) %}
		{% set raw_link = s.link|default(null) %}
		{% set link = raw_link is same as '' ? null : raw_link %}
		{% set items = items|merge([{ 
      rating: r is not empty ? (r + 0) : 0,
      testimonial: testimonial,
		full_name: full_name|default(testimonial_post.post_title|default('')),
      company: company,
      link: link
    }]) %}
	{% endif %}
{% endfor %}

<section class="py-12 md:py-20 px-6 lg:px-2 {{ is_class ? bg : '' }}" {% if bg_style %} style="{{ bg_style }}" {% endif %}>
	<div class="container mx-auto">
		<div class="lg:hidden rounded-tiz py-10 flex h-full flex-col justify-between">
			<div>
				<h2 class="scroll-animate text-4xl md:text-5xl text-bay-of-many-900 [&>span]:text-dodger-blue-600 [&>span]:font-semibold">
					{{ heading|default('Témoignages de clients') }}
				</h2>
			</div>
			<div
				class="mt-6">
				{# Variant A: Logo + 5 stars #}
				{% if show_google_logo %}
					<div class="scroll-animate mt-2 flex items-center gap-1">
						<span class="sr-only">Évaluation : 5 sur 5</span>
						{% for i in [1,2,3,4,5] %}
							<svg viewbox="0 0 24 24" class="h-6 w-6 text-amber-400" aria-label="star"><polygon fill="currentColor" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
						{% endfor %}
					</div>
					<div class="scroll-animate mt-2 text-3xl font-semibold">
						<svg aria-label="Google" height="3rem" style="flex:none;line-height:1" viewbox="0 0 77 24" xmlns="http://www.w3.org/2000/svg">
							<title>Google</title>
							<path d="M19.947 8.482H11.43v2.536h6.041c-.298 3.557-3.247 5.074-6.03 5.074-3.562 0-6.67-2.812-6.67-6.753 0-3.839 2.963-6.795 6.677-6.795 2.866 0 4.555 1.833 4.555 1.833l1.77-1.84S15.5 0 11.357 0C6.081 0 2 4.468 2 9.294c0 4.729 3.84 9.34 9.491 9.34 4.972 0 8.61-3.417 8.61-8.47 0-1.067-.154-1.683-.154-1.683" fill="#4285F4"></path>
							<path d="M26.96 8.997c1.719 0 3.347 1.395 3.347 3.642 0 2.199-1.621 3.633-3.355 3.633-1.905 0-3.408-1.53-3.408-3.65 0-2.075 1.485-3.625 3.416-3.625zm-.035-2.352c-3.495 0-6 2.742-6 5.94 0 3.245 2.43 6.038 6.041 6.038 3.27 0 5.948-2.508 5.948-5.968 0-3.967-3.116-6.01-5.989-6.01z" fill="#EB4335"></path>
							<path d="M40.01 8.997c1.718 0 3.347 1.395 3.347 3.642 0 2.199-1.622 3.633-3.356 3.633-1.904 0-3.407-1.53-3.407-3.65 0-2.075 1.484-3.625 3.415-3.625zm-.035-2.352c-3.496 0-6 2.742-6 5.94 0 3.245 2.43 6.038 6.04 6.038 3.27 0 5.949-2.508 5.949-5.968 0-3.967-3.116-6.01-5.99-6.01z" fill="#FBBC05"></path>
							<path d="M53.006 9c1.573 0 3.188 1.347 3.188 3.648 0 2.34-1.611 3.629-3.222 3.629-1.71 0-3.302-1.394-3.302-3.607 0-2.299 1.652-3.67 3.336-3.67zm-.232-2.349c-3.208 0-5.73 2.82-5.73 5.984 0 3.605 2.924 5.996 5.675 5.996 1.7 0 2.605-.678 3.273-1.455v1.18c0 2.067-1.25 3.304-3.137 3.304-1.824 0-2.738-1.36-3.056-2.132l-2.293.962c.813 1.726 2.451 3.527 5.368 3.527 3.19 0 5.62-2.016 5.62-6.244V7.012h-2.502v1.014c-.77-.832-1.821-1.375-3.218-1.375z" fill="#4285F4"></path>
							<path d="M69.725 8.94c1.09 0 1.875.582 2.209 1.28l-5.345 2.241c-.23-1.735 1.408-3.52 3.136-3.52zm-.104-2.303c-3.026 0-5.567 2.416-5.567 5.981 0 3.772 2.832 6.01 5.858 6.01 2.525 0 4.075-1.387 5-2.629l-2.063-1.377c-.536.833-1.43 1.648-2.925 1.648-1.678 0-2.45-.922-2.927-1.815L75 11.123l-.415-.976c-.774-1.913-2.577-3.51-4.964-3.51z" fill="#EB4335"></path>
							<path d="M60.239 18.272h2.628V.62H60.24z" fill="#34A853"></path>
						</svg>
					</div>

				{% else %}
					{# Variant B: 5 stars only #}
					<div class="scroll-animate flex items-center gap-1">
						<span class="sr-only">Évaluation : 5 sur 5</span>
						{% for i in [1,2,3,4,5] %}
							<svg viewbox="0 0 24 24" class="h-6 w-6 text-amber-400" aria-label="star"><polygon fill="currentColor" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
						{% endfor %}
					</div>
				{% endif %}
			</div>
		</div>

		<div
			class="grid grid-cols-1 lg:grid-cols-3 gap-6 auto-rows-[1fr]">
			{# Title card on large screens #}
			<div class="hidden lg:flex rounded-tiz py-10 h-full flex-col justify-between">
				<div>
					<h2 class="scroll-animate text-4xl md:text-5xl text-bay-of-many-900 [&>span]:text-dodger-blue-600 [&>span]:font-semibold">
						{{ heading|default('Témoignages de clients') }}
					</h2>
				</div>
				<div class="mt-6 {{ not show_google_logo ? 'mb-auto' : '' }}">
					{% if show_google_logo %}
						<div
							class="scroll-animate mt-2 text-3xl font-semibold">
							{# Google logo SVG #}
							<svg aria-label="Google" height="3rem" style="flex:none;line-height:1" viewbox="0 0 77 24" xmlns="http://www.w3.org/2000/svg">
								<title>Google</title>
								<path d="M19.947 8.482H11.43v2.536h6.041c-.298 3.557-3.247 5.074-6.03 5.074-3.562 0-6.67-2.812-6.67-6.753 0-3.839 2.963-6.795 6.677-6.795 2.866 0 4.555 1.833 4.555 1.833l1.77-1.84S15.5 0 11.357 0C6.081 0 2 4.468 2 9.294c0 4.729 3.84 9.34 9.491 9.34 4.972 0 8.61-3.417 8.61-8.47 0-1.067-.154-1.683-.154-1.683" fill="#4285F4"></path>
								<path d="M26.96 8.997c1.719 0 3.347 1.395 3.347 3.642 0 2.199-1.621 3.633-3.355 3.633-1.905 0-3.408-1.53-3.408-3.65 0-2.075 1.485-3.625 3.416-3.625zm-.035-2.352c-3.495 0-6 2.742-6 5.94 0 3.245 2.43 6.038 6.041 6.038 3.27 0 5.948-2.508 5.948-5.968 0-3.967-3.116-6.01-5.989-6.01z" fill="#EB4335"></path>
								<path d="M40.01 8.997c1.718 0 3.347 1.395 3.347 3.642 0 2.199-1.622 3.633-3.356 3.633-1.904 0-3.407-1.53-3.407-3.65 0-2.075 1.484-3.625 3.415-3.625zm-.035-2.352c-3.496 0-6 2.742-6 5.94 0 3.245 2.43 6.038 6.04 6.038 3.27 0 5.949-2.508 5.949-5.968 0-3.967-3.116-6.01-5.99-6.01z" fill="#FBBC05"></path>
								<path d="M53.006 9c1.573 0 3.188 1.347 3.188 3.648 0 2.34-1.611 3.629-3.222 3.629-1.71 0-3.302-1.394-3.302-3.607 0-2.299 1.652-3.67 3.336-3.67zm-.232-2.349c-3.208 0-5.73 2.82-5.73 5.984 0 3.605 2.924 5.996 5.675 5.996 1.7 0 2.605-.678 3.273-1.455v1.18c0 2.067-1.25 3.304-3.137 3.304-1.824 0-2.738-1.36-3.056-2.132l-2.293.962c.813 1.726 2.451 3.527 5.368 3.527 3.19 0 5.62-2.016 5.62-6.244V7.012h-2.502v1.014c-.77-.832-1.821-1.375-3.218-1.375z" fill="#4285F4"></path>
								<path d="M69.725 8.94c1.09 0 1.875.582 2.209 1.28l-5.345 2.241c-.23-1.735 1.408-3.52 3.136-3.52zm-.104-2.303c-3.026 0-5.567 2.416-5.567 5.981 0 3.772 2.832 6.01 5.858 6.01 2.525 0 4.075-1.387 5-2.629l-2.063-1.377c-.536.833-1.43 1.648-2.925 1.648-1.678 0-2.45-.922-2.927-1.815L75 11.123l-.415-.976c-.774-1.913-2.577-3.51-4.964-3.51z" fill="#EB4335"></path>
								<path d="M60.239 18.272h2.628V.62H60.24z" fill="#34A853"></path>
							</svg>
						</div>
						<div class="scroll-animate mt-2 flex items-center gap-1">
							<span class="sr-only">Évaluation : 5 sur 5</span>
							{% for i in [1,2,3,4,5] %}
								<svg viewbox="0 0 24 24" class="h-6 w-6 text-amber-400" aria-label="star"><polygon fill="currentColor" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
							{% endfor %}
						</div>
					{% else %}
						<div class="scroll-animate flex items-center gap-1">
							<span class="sr-only">Évaluation : 5 sur 5</span>
							{% for i in [1,2,3,4,5] %}
								<svg viewbox="0 0 24 24" class="h-6 w-6 text-amber-400" aria-label="star"><polygon fill="currentColor" points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
							{% endfor %}
						</div>
					{% endif %}
				</div>
			</div>

			{# Testimonial cards: 2 columns on large screens #}
			<div class="lg:col-span-2">
				{% set grid_classes = items|length == 1
          ? 'grid grid-cols-1 md:grid-cols-1 gap-6 auto-rows-[1fr]'
          : 'grid grid-cols-1 md:grid-cols-2 gap-6 auto-rows-[1fr]'
        %}
				{% include 'partials/components/cards/testimonial.twig' with {
          items: items,
          grid_classes: grid_classes,
							hide_stars: false,
							card_style: card_bg_style
        } %}
			</div>
		</div>
	</div>
</section>
